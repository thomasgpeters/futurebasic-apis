/*  ProgressObserver1*/_window = 1_progBar = 1_unitCount = 100void local fn MyProgressObserver( obj as CFTypeRef, keyPath as CFStringRef, change as CFDictionaryRef, context as ptr )UInt64 count = fn ProgressCompletedUnitCount( obj )dispatchmainprogressbar _progBar, countdispatchendend fnvoid local fn DoItwindow _window, @"Progress Indicator Observer"progressbar _progBar,, (20,20,510,20)ProgressRef progress = fn ProgressWithTotalUnitCount( _unitCount )ObjectAddObserver( progress, @"fractionCompleted", NSKeyValueObservingOptionInitial, @fn MyProgressObserver, NULL )block TimerRef t = timerbegin , 0.1, YESUInt64 count = fn ProgressCompletedUnitCount( progress ) + 1ProgressSetCompletedUnitCount( progress, count )if ( count >= _unitCount )ObjectRemoveObserver( progress, @"fractionCompleted" )TimerInvalidate( t ) : print @"done"end iftimerendend fnfn DoItHandleEvents