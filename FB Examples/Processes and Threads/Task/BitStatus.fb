/*  Drag and Drop View which uses NSTask to   determine bit status of an application.  Written by S.Van Voorst    {20180508}*/include "NSLog.incl"output "Bit_status"_window = 1_wndW = 350_wndH = 200begin enum 1_dragView_labelend enumvoid local fn RunCommand( currDirURL as CFURLRef, execName as CFStringRef )TaskRef tsk = fn TaskInitTaskSetExecutableURL( tsk, fn URLFileURLWithPath(@"/bin/sh") )TaskSetCurrentDirectoryURL( tsk, currDirURL )CFStringRef cmdStr = fn StringWithFormat(@"file %@",execName)CFArrayRef arguments = @[@"-c",cmdStr]TaskSetArguments( tsk, arguments )PipeRef pip = fn PipeInitTaskSetStandardOutput( tsk, pip )FileHandleRef fh = fn PipeFileHandleForReading( pip )fn TaskLaunch( tsk, NULL )if ( fn TaskIsRunning(tsk) ) then NSLog(@"Terminal is running.")TaskWaitUntilExit( tsk )long status = fn TaskTerminationStatus( tsk )NSLog(@"Termination status = %d",status)CFDataRef dta = fn FileHandleReadDataToEndOfFile( fh, NULL )CFStringRef outputStr = fn StringWithData( dta, NSUTF8StringEncoding )NSLog(@"%@",outputStr)end fnvoid local fn BuildWindowNSInteger   wndStyleMaskwndStyleMask = NSWindowStyleMaskTitledwndStyleMask += NSWindowStyleMaskClosablewndStyleMask += NSWindowStyleMaskMiniaturizablewindow _window, @"64-bit Checker", (0,0,_wndW,_wndH), wndStyleMasksubclassview _dragView, (0,0,_wndW,_wndH)ViewRegisterForDraggedFileTypes( _dragView, @"com.apple.application" )textlabel _label, @"Drop application here.", (_wndW/2-90,_wndH/2-10,180,20)ControlSetAlignment( _label, NSTextAlignmentCenter )end fnvoid local fn DoDialog( ev as long )CFURLRef      appURL, execDirURL, execURLCFStringRef   execNameselect ( ev )case _viewPerformDragOperationappURL = fn DialogEventURLexecURL = fn BundleExecutableURL( fn BundleWithURL(appURL) )NSLog(@"execURL = %@", execURL)execDirURL = fn URLByDeletingLastPathComponent( execURL )execName = fn URLLastPathComponent( execURL )NSLog(@"execName = %@", execName)fn RunCommand( execDirURL, execName )end selectend fnon dialog fn DoDialogfn BuildWindowHandleEvents