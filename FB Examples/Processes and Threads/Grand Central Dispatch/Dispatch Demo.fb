/*  Dispatch Demo 1  Bernie Wylde 20171108*/include "Tlbx Dispatch.incl"_window = 1begin enum 1_progBar_label_startBtnend enumvoid local fn Finishedbutton _startBtn, YESend fnvoid local fn UpdateUI( ctx as ptr )window output _window// ensure widget calls go to the right placeProgressIndicatorIncrementBy( _progBar, 1.0 )ControlTakeDoubleValueFrom( _label, _progBar )end fnvoid local fn MyDispatchFunction( ctx as ptr )long ifor i = 0 to 99dispatch_async_f( fn dispatch_get_main_queue, ctx, @fn UpdateUI )// UI changes must be done on the main queuedelay 40// do somethingnext idispatch_async_f( fn dispatch_get_main_queue, ctx, @fn Finished )end fnvoid local fn StartActionbutton _startBtn, NOProgressIndicatorSetDoubleValue( _progBar, 0.0 )textlabel _label, @"0"dispatch_async_f( fn dispatch_get_global_queue( DISPATCH_QUEUE_PRIORITY_DEFAULT, 0 ), NULL, @fn MyDispatchFunction )end fnvoid local fn BuildWindowwindow _window, @"Dispatch Demo 1", (0,0,480,140), NSWindowStyleMaskTitledprogressbar _progBar,, (20,101,440,20)ProgressIndicatorSetUsesThreadedAnimation( _progBar, NO )// fix cosmetic on Big Sur and abovetextlabel _label, @"0", (227,77,30,17)button _startBtn,,, @"Start", (396,13,70,32)end fnvoid local fn DoDialog( ev as long, tag as long )select ( ev )case _btnClickselect tagcase _startBtn : fn StartActionend selectend selectend fnfn BuildWindowon dialog fn DoDialogHandleEvents