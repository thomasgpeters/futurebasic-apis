/*  BusyWindow  Bernie Wylde 20180212*/include "Tlbx Dispatch.incl"include "NSLog.incl"// main functionvoid local fn Finished( ctx as ptr )WindowClose(2)NSLog(@"OK, I'm back!")end fn// global functionvoid local fn DoSomething( ctx as ptr )long i = 3000while (i)// do something in the backgrounddelay(1)i--wenddispatch_async_f( fn dispatch_get_main_queue, NULL, @fn Finished )// optionally call a function on the main thread to say we're finishedend fnvoid local fn ShowBusyWindowpanel 2, @"I'm just going outside...", (0,0,300,150)//, NSTitledWindowMaskWindowCenter(2)textlabel 1, @"... and may be some time", (70,66,160,17)dispatch_async_f( fn dispatch_get_global_queue( DISPATCH_QUEUE_PRIORITY_DEFAULT, 0 ), NULL, @fn DoSomething )end fnvoid local fn BuildWindowwindow 1WindowCenter(1)button 1,,, @"Start", (213,13,125,32)end fnvoid local fn DoDialog( ev as long )if ( ev == _btnClick ) then fn ShowBusyWindowend fnfn BuildWindowon dialog fn DoDialogHandleEvents