_window = 1_startBtn = 1begin globalsCGFloat gValueend globalsvoid local fn ViewDrawBezierPathRef   pathif ( gValue )path = fn BezierPathInitBezierPathMoveToPoint( path, fn CGPointMake(0,200) )BezierPathLineToPoint( path, fn CGPointMake(gValue,200) )BezierPathSetLineWidth( path, 5 )ColorSet( fn ColorRed )BezierPathStroke( path )end ifend fnvoid local fn Finishedbutton _startBtn, YES,,,,,, _windowend fnvoid local fn UpdateUIwindow output _windowgValue++ViewSetNeedsDisplay( _windowContentViewTag )end fnvoid local fn BackgroundFunctionlong ifor i = 0 to 550delay 1ObjectCallFunctionOnMainThread( @fn UpdateUI, NULL, YES )next iObjectCallFunctionOnMainThread( @fn Finished, NULL, YES )end fnvoid local fn Startbutton _startBtn, NOgValue = 0ObjectCallFunctionInBackground( @fn BackgroundFunction, NULL )end fnvoid local fn BuildWindowwindow _window, @"Background Drawing", (0,0,550,400)WindowSubclassContentView( _window )ViewSetFlipped( _windowContentViewTag, YES )button _startBtn,,, @"Start"ViewSetAutoresizingMask( _startBtn, NSViewMaxYMargin )end fnvoid local fn DoDialog( ev as long, tag as long )select ( ev )case _btnClick : fn Startcase _viewDrawRect : fn ViewDrawend selectend fnfn BuildWindowon dialog fn DoDialogHandleEvents