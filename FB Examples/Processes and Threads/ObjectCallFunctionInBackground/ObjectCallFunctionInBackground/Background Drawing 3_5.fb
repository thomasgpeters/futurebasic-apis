/*  Background Drawing 3  Bernie Wylde 20180712*/_drawingWnd = 1_controlPanel = 2begin enum 1_drawBtnend enumbegin globalsBezierPathRef gPathend globalsvoid local fn ViewDrawwindow output _drawingWndif ( gPath )BezierPathStroke( gPath )end ifend fnvoid local fn Finishedbutton _drawBtn, YES,,,,,, _controlPanelend fnvoid local fn TriggerRedrawwindow output _drawingWndViewSetNeedsDisplay(_windowContentViewTag)end fnvoid local fn AddPath( path as BezierPathRef )CGPoint pt1 = {rnd(600),rnd(600)}CGPoint pt2 = {rnd(600),rnd(600)}BezierPathRef path2 = fn BezierPathInitBezierPathMoveToPoint( path2, pt1 )BezierPathLineToPoint( path2, pt2 )BezierPathAppendPath( path, path2 )end fnvoid local fn BackgroundFunction( path as BezierPathRef )long   ifor i = 0 to 200delay 15// slow things down a bit so we can see it workingfn AddPath( path )ObjectCallFunctionOnMainThread( @fn TriggerRedraw, NULL, YES )next iObjectCallFunctionOnMainThread( @fn Finished, NULL, YES )end fnvoid local fn StartDrawingbutton _drawBtn, NOgPath = fn CFRetain( fn BezierPathInit )ObjectCallFunctionInBackground( @fn BackgroundFunction, gPath )end fnvoid local fn BuildWindowswindow _drawingWnd, @"Background Drawing", (0,0,600,600), NSWindowStyleMaskTitledWindowSubclassContentView(_drawingWnd)CGRect r = fn WindowContentRectForFrameRect( _drawingWnd, fn WindowFrame( _drawingWnd ) )r = fn CGRectMake(r.origin.x-170,r.origin.y+r.size.height-150,150,150)panel _controlPanel, @"Control", r, NSWindowStyleMaskTitled + NSWindowStyleMaskUtilityWindowbutton _drawBtn,,, @"Draw", (40,60,70,28)ControlSetSize( _drawBtn, NSControlSizeSmall )WindowAddChildWindow( _drawingWnd, _controlPanel, NSWindowAbove )end fnvoid local fn DoDialog( ev as long, tag as long, wnd as long )select ( ev )case _btnClickselect ( wnd )case _controlPanelselect ( tag )case _drawBtn : fn StartDrawingend selectend selectcase _viewDrawRect : fn ViewDrawend selectend fnfn BuildWindowson dialog fn DoDialogHandleEvents