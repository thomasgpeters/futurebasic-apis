//---------------------------------------------------------// Based on Ken Shmidheiser's FB list post in early March 2022// Modifications: Brian & Bernie//// N.B. The keys used below ( @"formattedStringValue", @"formattedInternationalStringValue" )// and the new FB convenience functions from CNPhoneNumber.incl// are not documented or exposed by Apple in their Contacts.h header ( as of 5-March-2022 ),// so their use is **RISKY**. Someone hacked Apple's code to figure out these properties exist.//---------------------------------------------------------include "NSLog.incl"include "Tlbx Contacts.incl"//---------------------------------------------------------// returns the formated string value in array index zero// returns the formated international string value in array index one.//// fn CopyFormatedPhoneNum uses the private property names of CNPhoneNumber//---------------------------------------------------------local fn CopyFormatedPhoneNum( phoneNumberStr as CFStringRef ) as CFArrayRefCNPhoneNumberRef pRef = fn CNPhoneNumberWithStringValue( phoneNumberStr)CFArrayRef array = @[fn ObjectValueForKey( pRef, @"formattedStringValue"), fn ObjectValueForKey( pRef, @"formattedInternationalStringValue")]end fn = fn CFRetain( array )// MainCFArrayRef formattedPhoneNumbersArray// Accessing the private properties by using the keysNSLog( @"---- Using the Keys Directly ----")formattedPhoneNumbersArray = fn CopyFormatedPhoneNum(@"6173839007")NSLog(@"Local format: %@", fn ArrayObjectAtIndex( formattedPhoneNumbersArray, 0) )NSLog(@"International format: %@", fn ArrayObjectAtIndex( formattedPhoneNumbersArray, 1) )CFRelease( formattedPhoneNumbersArray )//---------------------------------------------------------// Convenience functions from the CNPhoneNumber.incl FB Header//---------------------------------------------------------CNPhoneNumberRef pRefpRef = fn CNPhoneNumberWithStringValue( @"6173839007" )NSLog( @"\n---- Using the Convenience Functions ----")NSLog( @"Country Code: %@",fn CNPhoneNumberCountryCode( pRef ) )NSLog( @"Raw digits: %@"  ,fn CNPhoneNumberDigits( pRef ) )NSLog( @"International Formatted: %@",fn CNPhoneNumberFormattedInternationalStringValue( pRef ) )NSLog( @"Local Format: %@",fn CNPhoneNumberFormattedStringValue( pRef ) )NSLog( @"International Unformatted: %@",fn CNPhoneNumberUnformattedInternationalStringValue( pRef ) )HandleEvents