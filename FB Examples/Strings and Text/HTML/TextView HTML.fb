_window = 1begin enum 1_scrollView_textView_htmlToStringBtn_stringToHtmlBtnend enumvoid local fn TextViewHTMLToString( tag as NSInteger )CFStringRef   style, styledHTMLstyle = fn StringWithFormat( @"<meta charset=\"UTF-8\"><style> body {font-family:'%@'; font-size:%0.0fpx;}</style>", @"Helvetica", 12 )styledHTML = fn StringWithFormat( @"%@%@", style, fn TextString( tag ) )CFDictionaryRef options = @{NSDocumentTypeDocumentAttribute:NSHTMLTextDocumentType}CFAttributedStringRef aString = fn AttributedStringWithData( fn StringData( styledHTML, NSUTF8StringEncoding ), options, NULL, NULL )CFMutableAttributedStringRef textStorage = fn TextViewMutableAttributedString( tag )MutableAttributedStringReplaceCharactersInRangeWithAttributedString( textStorage, fn CFRangeMake(0,fn AttributedStringLength(textStorage)), aString )end fnvoid local fn TextViewStringToHTML( tag as NSInteger )CFMutableAttributedStringRef textStorage = fn TextViewMutableAttributedString( tag )CFDictionaryRef attrs = @{NSDocumentTypeDocumentAttribute:NSHTMLTextDocumentType}CFDataRef dta = fn AttributedStringDataFromRange( textStorage, fn CFRangeMake(0,fn AttributedStringLength(textStorage)), attrs, NULL )CFStringRef html = fn StringWithData( dta, NSUTF8StringEncoding )TextSetString( tag, html )end fnvoid local fn BuildWindowwindow _window, @"TextView HTML", (0,0,550,400), NSWindowStyleMaskTitledscrollview _scrollView, (20,61,510,319), NSBezelBordertextview _textView,, _scrollViewbutton _htmlToStringBtn,,, @"HTML to String", (14,13,132,32)button _stringToHtmlBtn,,, @"String to HTML", (146,13,122,32)CFStringRef html = @"This <b>is</b> an <i>example</i> of a <b><i>text</i></b>."TextSetString( _textView, html )end fnvoid local fn DoDialog( ev as long, tag as long )select ( ev )case _btnClickselect( tag )case _htmlToStringBtn : fn TextViewHTMLToString( _textView )case _stringToHtmlBtn : fn TextViewStringToHTML( _textView )end selectend selectend fnfn BuildWindowon dialog fn DoDialogHandleEvents