/*  ColorWell Styles  1: Default - Displays color panel.  2: Minimal - Displays popover with color picker.  3: Minimal with custom popover.  4: Expanded - Supports color picker popover and adds dedicated button to display color panel.  5: Expanded with custom image.  Requires: macOS 13.0+*/#define GOLD   fn ColorWithRGB(0.831,0.686,0.216,1.0)#define SILVER fn ColorWithRGB(0.667,0.663,0.678,1.0)#define BRONZE fn ColorWithRGB(0.520,0.416,0.256,1.0)#define MOUSE_INSIDE_KEY @"mouseInside"_window = 1begin enum 1_well1_well2_well3_well4_well5_label1_label2_label3_label4_label5end enum_popover = 2begin enum 1_goldView_silverView_bronzeViewend enumvoid local fn BuildWindow// windowwindow _window, @"ColorWell Styles", (0,0,271,240)colorwell _well1,, fn ColorSystemRed, (17,194,44,28)textlabel _label1, @"Default", (96,200,48,16)colorwell _well2,, fn ColorSystemGreen, (17,150,44,28), NSColorWellStyleMinimaltextlabel _label2, @"Minimal", (96,156,51,16)colorwell _well3,, BRONZE, (17,106,44,28), NSColorWellStyleMinimalColorWellEnablePulldownAction( _well3, YES )textlabel _label3, @"Minimal, custom", (96,112,103,16)colorwell _well4,, fn ColorSystemBlue, (17,62,64,28), NSColorWellStyleExpandedtextlabel _label4, @"Expanded, default image", (96,68,154,16)colorwell _well5,, fn ColorSystemPurple, (17,18,64,28), NSColorWellStyleExpandedColorWellSetImage( _well5, fn ImageNamed( NSImageNameInfo ) )textlabel _label5, @"Minimal", (96,24,157,16)// popoverpopover _popover, (0,0,82,34), NSPopoverBehaviorTransientsubclass view _goldView, (5,5,24,24)ViewSetWantsLayer( _goldView, YES )CALayerSetBackgroundColor( fn ViewLayer(_goldView), GOLD )ViewInitTrackingArea( _goldView )subclass view _silverView, (29,5,24,24)ViewSetWantsLayer( _silverView, YES )CALayerSetBackgroundColor( fn ViewLayer(_silverView), SILVER )ViewInitTrackingArea( _silverView )subclass view _bronzeView, (53,5,24,24)ViewSetWantsLayer( _bronzeView, YES )CALayerSetBackgroundColor( fn ViewLayer(_bronzeView), BRONZE )ViewInitTrackingArea( _bronzeView )end fnvoid local fn ViewDrawRect( tag as long )CGRect r = fn ViewBounds( tag )BOOL inside = fn ViewPropertyBool( tag, MOUSE_INSIDE_KEY )if ( inside )BezierPathStrokeRect( r, 6.0, fn ColorWhite )BezierPathStrokeRect( r, 1.0, fn ColorBlack )r = fn CGRectInset( r, 3, 3 )BezierPathStrokeRect( r, 0.5, fn ColorBlack )end ifend fnvoid local fn DoDialog( ev as long, tag as long, wnd as long )ColorRef colorselect ( wnd )case _windowselect ( ev )case _colorWellPulldownselect ( tag )case _well3 : PopoverShow( _popover, CGRectZero, tag, CGRectMinYEdge )end selectend selectcase _popoverselect ( ev )case _viewDrawRect : fn ViewDrawRect( tag )case _viewMouseEntered, _viewMouseExitedViewPropertySetBool( tag, MOUSE_INSIDE_KEY, (ev == _viewMouseEntered) )ViewSetNeedsDisplay( tag )case _viewMouseDowncolor = fn CALayerBackgroundColor( fn ViewLayer(tag) )PopoverPerformClose( _popover )colorwell _well3,, color,,, _windowend selectend selectend fnfn BuildWindowon dialog fn DoDialogHandleEvents