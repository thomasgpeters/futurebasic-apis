/*  CameraView  Ken Shmidheiser and Bernie Wylde  20220412*/include "Tlbx AVFoundation.incl"//#plist NSMicrophoneUsageDescription @"Your microphone will be used to record sounds."#plist NSCameraUsageDescription @"Your camera will be used to display video."#define SESSION_KEY       @"session"#define PREVIEW_LAYER_KEY @"previewLayer"_window = 1begin enum 1_cameraView_captureBtnend enumvoid local fn BuildWindowwindow _window, @"Capture Video", (0,0,480,360)WindowSetContentMinSize( _window, fn CGSizeMake(160,100) )view _cameraView, (20,60,440,280)ViewSetAutoresizingMask( _cameraView, NSViewWidthSizable + NSViewHeightSizable )button _captureBtn,,, @"Capture", (199,13,83,32)ViewSetAutoresizingMask( _captureBtn, NSViewMinXMargin + NSViewMaxXMargin + NSViewMaxYMargin )end fnvoid local fn StartSessionAVCaptureVideoPreviewLayerRef previewLayerAVCaptureSessionRef           sessionAVCaptureDeviceRef            deviceAVCaptureDeviceInputRef       inputDevicesession = fn AVCaptureSessionInitAppPropertySet( SESSION_KEY, session )device = fn AVCaptureDeviceDefaultWithMediaType( AVMediaTypeVideo )inputDevice = fn AVCaptureDeviceInputWithDevice( device, NULL )if ( fn AVCaptureSessionCanAddInput( session, inputDevice ) )AVCaptureSessionAddInput( session, inputDevice )end ifpreviewLayer = fn AVCaptureVideoPreviewLayerWithSession( session )AppPropertySet( PREVIEW_LAYER_KEY, previewLayer )CALayerSetFrame( previewLayer, fn ViewBounds( _cameraView ) )AVCaptureVideoPreviewLayerSetVideoGravity( previewLayer, AVLayerVideoGravityResizeAspectFill )CALayerAddSublayer( fn ViewLayer(_cameraView), previewLayer )CALayerSetAutoresizingMask( previewLayer, NSViewWidthSizable + NSViewHeightSizable )AVCaptureSessionStartRunning( session )end fnvoid local fn DoDialog( ev as long, tag as long, wnd as long, obj as CFTypeRef )select ( ev )case _btnClickselect ( tag )case _captureBtn : fn StartSessionend selectend selectend fnfn BuildWindowon dialog fn DoDialogHandleEvents