/*  3D Moon Orbiting Rotating Earth  SceneKit programming with FutureBasic  Demonstrates:  1. Application of a flat map projection onto spherical SceneKit shape.  2. Rotating an object on its axis.  3. Synchronically orbiting a satellite object around the axis of another object.  Ken Shmidheiser  14 October 2022*/include "Tlbx SceneKit.incl"include resources "earth.jpg"include resources "night_sky.jpg"include resources "moon.jpg"_window = 1begin enum output 1_sceneViewend enumlocal fn InitScene as SCNSceneRefSCNSceneRef   scene = fn SCNSceneInitSCNNodeRef rootNode = fn SCNSceneRootNode( scene )SCNMaterialPropertySetContents( fn SCNSceneBackground( scene ), fn ImageNamed( (CFStringRef)@"night_sky.jpg" ) ) // Set sceneview background image// Create and add a camera to the sceneSCNCameraRef   camera = fn SCNCameraInitSCNNodeRef cameraNode = fn SCNNodeInitSCNNodeSetCamera( cameraNode, camera )SCNNodeAddChildNode( rootNode, cameraNode )// Place the cameraSCNNodeSetPosition( cameraNode, fn SCNVector3Make( 0, 3, 18 ) )SCNCameraSetZFar( camera, 100.0 )SCNVector4 rotation = fn SCNVector4Make( 1, 0, 0, -M_PI_4/4 )SCNNodeSetRotation( cameraNode, rotation )// Build the EarthSCNSphereRef earth = fn SCNSphereInit( 5.0 )SCNMaterialRef earthMaterial = fn SCNMaterialInitSCNMaterialPropertySetContents( fn SCNMaterialDiffuse( earthMaterial ), fn ImageNamed( @"earth.jpg" ) )SCNMaterialSetShininess( earthMaterial, 0.1 )SCNGeometrySetMaterials( earth, @[earthMaterial] )SCNNodeRef earthNode = fn SCNNodeWithGeometry( earth )SCNActionableRunAction( earthNode, fn SCNActionRepeatActionForever( fn SCNActionRotateByAngle( M_PI, fn SCNVector3Make( 0.0, 25.0, 5.0 ), 5.0 ) ) )SCNNodeAddChildNode( rootNode, earthNode )// Build the MoonSCNSphereRef   moon = fn SCNSphereInit( 0.7 )SCNNodeRef moonNode = fn SCNNodeWithGeometry( moon )SCNNodeSetPosition( moonNode, fn SCNVector3Make( 10, 0, 0 ) )SCNActionableRunAction( moonNode, fn SCNActionRepeatActionForever( fn SCNActionRotateByAngle( M_PI, fn SCNVector3Make( 0.0, 25.0, 5.0 ), 5.0 ) ) )SCNMaterialRef moonMaterial = fn SCNMaterialInitSCNMaterialPropertySetContents( fn SCNMaterialDiffuse( moonMaterial ), fn ImageNamed( @"moon.jpg" ) )SCNMaterialSetLocksAmbientWithDiffuse( moonMaterial, YES )SCNGeometrySetMaterials( moon, @[moonMaterial] )SCNNodeAddChildNode( rootNode, moonNode )// Moon-rotation (center of rotation of the Moon around the Earth)SCNNodeRef moonRotationNode = fn SCNNodeInitSCNNodeAddChildNode( moonRotationNode, moonNode )SCNActionableRunAction( moonRotationNode, fn SCNActionRepeatActionForever( fn SCNActionRotateByAngle( M_PI, fn SCNVector3Make( 0.0, 25.0, 5.0 ), 5.0 ) ) ) // Moon orbitSCNNodeAddChildNode( rootNode, moonRotationNode )end fn = scenevoid local fn BuildWindowwindow _window, @"3D Moon Orbiting Rotating Earth", ( 0, 0, 600, 450 )scnview _sceneView, fn InitScene, ( 0, 0, 600, 450 )SCNViewSetBackgroundColor( 1, fn ColorBlack )SCNViewSetAllowsCameraControl( 1, YES )end fnvoid local fn DoDialog( ev as long, tag as long, wnd as long )select (ev)case _windowWillClose : endend selectend fnon dialog fn DoDialogfn BuildWindowHandleEvents