/*  Table Thingy  Based on a demo by Steve Van Voorst*/_window = 1begin enum 1_scrollView_textView_insertTableBtn_showTablePanelBtnend enumlocal fn TableCellAttributedStringWithString( table as TextTableRef, row as NSInteger, column as NSInteger, string as CFStringRef, borderColor as ColorRef, backgroundColor as ColorRef ) as CFAttributedStringRefTextTableBlockRef              blkMutableParagraphStyleRef       styleCFMutableAttributedStringRef   cellStringblk = fn TextTableBlockWithTable( table, row, 1, column, 1 )TextBlockSetBorderColor( blk, borderColor )TextBlockSetBackgroundColor( blk, backgroundColor )TextBlockSetWidth( blk, 4.0, NSTextBlockAbsoluteValueType, NSTextBlockBorder )TextBlockSetWidth( blk, 6.0, NSTextBlockAbsoluteValueType, NSTextBlockPadding )style = fn ObjectMutableCopy(fn ParagraphStyleDefaultStyle)MutableParagraphStyleSetTextBlocks( style, @[blk] )cellString = fn MutableAttributedStringWithString( string )MutableAttributedStringAddAttributeInRange( cellString, NSParagraphStyleAttributeName, style, fn CFRangeMake(0,fn AttributedStringLength(cellString)) )end fn = cellStringlocal fn TableAttributedString as CFAttributedStringRefCFMutableAttributedStringRef   tableStringTextTableRef                   tableCFAttributedStringRef          aStringtableString = fn MutableAttributedStringWithString( @"\n\n" )table = fn TextTableInitTextTableSetNumberOfColumns( table, 2 )// 0,0aString = fn TableCellAttributedStringWithString( table, 0, 0, @"Cell1\n", fn ColorMagenta, fn ColorGreen )MutableAttributedStringAppendAttributedString( tableString, aString )// 0,1aString = fn TableCellAttributedStringWithString( table, 0, 1, @"Cell2\n", fn ColorBlue, fn ColorYellow )MutableAttributedStringAppendAttributedString( tableString, aString )// 1,0aString = fn TableCellAttributedStringWithString( table, 1, 0, @"Cell3\n", fn ColorRed, fn ColorLightGray )MutableAttributedStringAppendAttributedString( tableString, aString )// 1,1aString = fn TableCellAttributedStringWithString( table, 1, 1, @"Cell4\n", fn ColorOrange, fn ColorCyan )MutableAttributedStringAppendAttributedString( tableString, aString )end fn = tableStringvoid local fn InsertTableCFRange                        charRangeCFMutableAttributedStringRef   textStorageCFAttributedStringRef          aStringcharRange = fn TextViewRangeForUserTextChange( _textView )textStorage = (CFMutableAttributedStringRef)fn TextViewTextStorage( _textView )aString = fn TableAttributedStringMutableAttributedStringReplaceCharactersInRangeWithAttributedString( textStorage, charRange, aString )TextViewSetSelectedRangeAffinity( _textView, fn CFRangeMake(charRange.location,0), NSSelectionAffinityUpstream, NO )end fnvoid local fn ShowTablePanelTextViewOrderFrontTablePanel( _textView )end fnvoid local fn BuildWindowwindow _window, @"Table Thingy", (0,0,500,550)WindowSetContentMinSize( _window, fn CGSizeMake(285,180) )scrollview _scrollView, (20,61,460,469), NSBezelBorderViewSetAutoresizingMask( _scrollView, NSViewWidthSizable + NSViewHeightSizable )textview _textView,, _scrollViewbutton _insertTableBtn,,, @"Insert Table", (14,13,111,32)ViewSetAutoresizingMask( _insertTableBtn, NSViewMaxYMargin )ControlSetActionCallback( _insertTableBtn, @fn InsertTable, NULL )button _showTablePanelBtn,,, @"Show Table Panel", (125,13,146,32)ViewSetAutoresizingMask( _showTablePanelBtn, NSViewMaxYMargin )ControlSetActionCallback( _showTablePanelBtn, @fn ShowTablePanel, NULL )WindowMakeFirstResponder( _window, _textView )end fneditmenu 1fn BuildWindowHandleEvents