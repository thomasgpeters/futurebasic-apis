#build WarnOfScopedVars NO_window = 1begin enum 1_label_scrollView_textViewend enumlocal fn Dictionary as CFArrayRefCFURLRef url = fn URLFileURLWithPath( @"/usr/share/dict/words" )CFStringRef string = fn StringWithContentsOfURL( url, NSUTF8StringEncoding, NULL )end fn = fn StringComponentsSeparatedByCharactersInSet( string, fn CharacterSetNewlineSet )void local fn BuildWindowwindow _window, @"TextView Completions", (0,0,480,360), NSWindowStyleMaskTitledtextlabel _label, @"Start typing a word and hit the 'esc' key.", (18,324,248,16)scrollview _scrollView, (20,20,440,296)subclass textview _textView,, _scrollViewTextSetFont( _textView, fn FontWithName( @"Times", 24 ) )WindowMakeFirstResponder( _window, _textView )end fnvoid local fn DoDialog( ev as long, tag as long )select ( ev )case _viewKeyDownselect ( tag )case _textViewif ( fn EventKeyCode == 53 )// 'esc' keyTextViewComplete( tag )DialogEventSetBool( YES )// we handledend ifend select// uncomment these lines to display words after each key press/*case _textDidChangeselect ( tag )case _textView : TextViewComplete( tag )end select*/case _textViewCompletionsselect ( tag )case _textViewCFRange range = fn DialogEventRangeCFStringRef string = fn StringSubstringWithRange( fn TextString( tag ), range )PredicateRef predicate = fn PredicateWithFormat( @"SELF beginswith[c] %@",string )CFArrayRef words = fn ArrayFilteredArrayUsingPredicate( fn Dictionary, predicate )words = fn ArraySortedArrayUsingSelector( words, @"caseInsensitiveCompare:" )DialogEventSetLong(-1)// don't select an itemDialogEventSetArray( words )end selectend selectend fnfn BuildWindowon dialog fn DoDialogHandleEvents