#plist NSAppTransportSecurity @{NSAllowsArbitraryLoads:YES}include "Tlbx Dispatch.incl"void local fn SetImage( ctx as ptr )ImageViewSetImage( 1, ctx)end fnvoid local fn DownloadHandler( session as URLSessionRef, location as CFURLRef )ImageRef   imageimage = fn ImageByReferencingURL( location )dispatch_sync_f( fn dispatch_get_main_queue, image, @fn SetImage )// update imageview on main threadend fnvoid local fn DownloadImageCFURLRef                    urlURLSessionDownloadTaskRef   taskurl = fn URLWithString(@"http://upload.wikimedia.org/wikipedia/commons/7/7f/Williams_River-27527.jpg")task = fn URLSessionDownloadTaskWithURLCompletionHandler( fn URLSessionSharedSession, url, @fn DownloadHandler, NULL )URLSessionTaskResume( task )end fnvoid local fn BuildWindowwindow 1, @"URLSession Demo", (0,0,480,360), NSWindowStyleMaskTitledimageview 1,,, (20,61,436,279)button 2,,, @"Download Image", (14,13,141,32)end fnvoid local fn DoDialog( ev as long )if ( ev == _btnClick ) then fn DownloadImageend fnfn BuildWindowon dialog fn DoDialogHandleEvents